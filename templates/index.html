<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpellStock AI | Predictive Inventory</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='Styles/main.css') }}">
    <script src="{{ url_for('static', filename='backend/main.js') }}"></script>
</head>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>


<body class="noise-overlay bg-[#0a0a0c] text-[#f8fafc] overflow-x-hidden min-h-screen">
    <div id="root">
        <!-- Login View -->
        <div id="login-view" class="min-h-screen flex items-center justify-center relative overflow-hidden">
            <div class="fixed inset-0 bg-indigo-600/8 blur-[120px] -z-10 rounded-full"></div>
            <div class="glass-panel p-10 w-full max-w-md space-y-6 relative z-10">
                <div class="text-center space-y-2">
                    <div class="h-14 w-14 glass-panel rounded-2xl mx-auto flex items-center justify-center mb-5">
                        <div class="w-5 h-5 bg-indigo-500/90 rounded-sm rotate-45"></div>
                    </div>
                    <h1 class="page-title text-2xl font-bold text-white">SpellStock</h1>
                    <p class="chart-label text-[10px] text-white/40 uppercase tracking-widest">Initialize Neural Link
                    </p>
                </div>
                <div class="space-y-4">
                    <div class="space-y-1.5">
                        <label class="chart-label text-[10px] text-white/50 block">Node Identity</label>
                        <input type="text" value="admin_main" class="input-clean w-full px-4 py-3 rounded-xl text-sm">
                    </div>
                    <div class="space-y-1.5">
                        <label class="chart-label text-[10px] text-white/50 block">Access Key</label>
                        <input type="password" value="••••••••" class="input-clean w-full px-4 py-3 rounded-xl text-sm">
                    </div>
                    <button id="btn-login" class="btn-primary w-full py-3.5 rounded-xl font-semibold text-sm">
                        Enter System
                    </button>
                </div>
                <p class="chart-subtext text-center text-white/30">Authorized Personnel Only</p>
            </div>
        </div>

        <!-- Dashboard View (Hidden by default) -->
        <div id="dashboard-view" class="hidden min-h-screen flex">
            <!-- Sidebar -->
            <aside class="w-64 border-r border-white/5 bg-[#0a0a0c] flex flex-col h-screen sticky top-0 z-[60]">
                <div class="p-6 border-b border-white/5 flex items-center gap-3">
                    <div class="h-8 w-8 bg-indigo-500/90 rounded-lg flex items-center justify-center rotate-45">
                        <div class="w-2 h-2 bg-white rounded-full"></div>
                    </div>
                    <span class="page-title text-base font-bold text-white">SpellStock</span>
                </div>
                <nav class="flex-1 p-4 space-y-1 overflow-y-auto" id="sidebar-nav"></nav>
                <div class="p-4 border-t border-white/5 space-y-3">
                    <div class="flex items-center gap-3 px-2">
                        <div
                            class="w-8 h-8 rounded-full bg-indigo-500/20 border border-indigo-500/30 flex items-center justify-center text-[10px] font-bold">
                            JD</div>
                        <div>
                            <p class="text-[10px] font-bold uppercase tracking-widest text-white">Chef de Node</p>
                            <p class="text-[9px] mono text-white/30 uppercase">ID: 4402-B</p>
                        </div>
                    </div>
                    <button id="btn-logout" type="button"
                        class="w-full py-2 text-[10px] mono uppercase text-white/30 hover:text-white transition-colors flex items-center justify-center gap-2">
                        <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                        </svg>
                        Terminate Link
                    </button>
                </div>
            </aside>

            <!-- Main Content -->
            <div class="flex-1 flex flex-col relative">
                <header
                    class="px-8 py-3 border-b border-white/5 flex items-center justify-between sticky top-0 bg-[#0a0a0c]/90 backdrop-blur-xl z-50">
                    <div>
                        <h1 class="page-title text-lg font-bold text-white">Dashboard</h1>
                        <p class="chart-label text-[10px] text-white/40 mt-0.5">AI prediction · Stock & risk</p>
                    </div>
                    <div class="flex items-center gap-5">
                        <div class="flex flex-col items-end">
                            <span class="chart-label text-[9px] text-white/30">Server Load</span>
                            <span class="text-xs font-semibold text-emerald-400">0.02ms</span>
                        </div>
                        <div class="h-6 w-px bg-white/10"></div>
                        <div class="flex items-center gap-2 px-3 py-1.5 rounded-full bg-white/5 border border-white/5">
                            <div class="w-1.5 h-1.5 rounded-full bg-emerald-400"></div>
                            <span class="chart-label text-[10px] text-white/70">Gemini Connected</span>
                        </div>
                    </div>
                </header>

                <main class="px-8 pt-4 pb-8 space-y-6 max-w-[1400px] flex-1">
                    <!-- Oracle Dashboard panel -->
                    <div id="oracle-panel" class="space-y-6">
                        <section class="grid grid-cols-1 xl:grid-cols-12 gap-6 items-start">
                            <div class="xl:col-span-8 space-y-4">
                                <h2 class="section-title text-sm text-white/60">Scenario Input Console</h2>
                                <div class="glass-panel p-6 relative overflow-hidden group">
                                    <div class="absolute top-0 right-0 p-8 opacity-5">
                                        <svg class="w-32 h-32" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                                        </svg>
                                    </div>
                                    <textarea id="scenario-input" placeholder="Describe the upcoming demand shift..."
                                        class="w-full bg-transparent border-none text-lg font-medium placeholder:text-white/20 focus:ring-0 resize-none h-36 mb-4 leading-snug"></textarea>
                                    <div class="flex items-center justify-between border-t border-white/5 pt-5">
                                        <div class="flex flex-wrap gap-2" id="quick-actions"></div>
                                        <button id="btn-ignite" type="button"
                                            class="btn-primary flex items-center gap-3 py-2 pl-2 pr-6 rounded-full text-sm font-semibold disabled:opacity-40 disabled:cursor-not-allowed">
                                            <div id="ignite-icon"
                                                class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-black">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor"
                                                    viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round"
                                                        stroke-width="2.5" d="M14 5l7 7m0 0l-7 7m7-7H3" />
                                                </svg>
                                            </div>
                                            <span>Ignite Logic</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="xl:col-span-4 space-y-4 h-full">
                                <h2 class="section-title text-sm text-white/50">Node Parameters</h2>
                                <div id="params-panel"
                                    class="glass-panel p-6 min-h-[320px] flex flex-col justify-between kinetic-border">
                                    <div class="flex flex-col items-center justify-center h-full text-center space-y-4">
                                        <div
                                            class="w-12 h-12 border border-white/10 rounded-full flex items-center justify-center animate-pulse">
                                            <div class="w-2 h-2 bg-indigo-500/40 rounded-full"></div>
                                        </div>
                                        <p class="text-[10px] mono uppercase text-white/20 tracking-[0.2em]">Awaiting
                                            Simulation Data</p>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <section class="space-y-5">
                            <div class="flex items-end justify-between flex-wrap gap-4">
                                <div>
                                    <h2 class="page-title text-2xl font-bold text-white">Strategic <span
                                            class="text-white/50">Outlook</span></h2>
                                    <p id="inventory-count" class="chart-subtext text-sm text-white/40 mt-1">Predicted
                                        exhaustion across key nodes.</p>
                                </div>
                                <div id="dashboard-stats" class="hidden md:flex gap-6"></div>
                            </div>
                            <!-- Dynamic alert-driven outlook cards -->
                            <div id="outlook-alerts" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"></div>
                        </section>


                        <div class="pb-16"></div>
                    </div>

                    <!-- Inventory Hub panel (hidden by default) -->
                    <div id="inventory-hub-panel" class="hidden space-y-6 pb-16">
                        <div class="flex items-center justify-between flex-wrap gap-4">
                            <h2 class="section-title text-sm text-white/60">Restaurant Inventory Overview</h2>
                            <div class="flex items-center gap-2">
                                <label for="hub-restaurant-select"
                                    class="chart-label text-[10px] text-white/50">Location</label>
                                <select id="hub-restaurant-select"
                                    class="input-clean px-4 py-2 rounded-xl text-sm min-w-[160px]">
                                    <option value="main">Main Kitchen</option>
                                    <option value="downtown">Downtown Branch</option>
                                    <option value="harbor">Harbor View</option>
                                </select>
                            </div>
                        </div>
                        <div class="glass-panel p-6">
                            <h3 class="chart-label text-xs font-semibold text-white/50 mb-1">Location-by-Location
                                Comparison</h3>
                            <p class="chart-subtext text-[10px] text-white/40 mb-4">Score 0–10 across locations</p>
                            <div class="h-[280px] flex items-center justify-center">
                                <canvas id="chart-comparison-bar" width="600" height="280"></canvas>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-5">
                            <div class="glass-panel p-6">
                                <h3 class="chart-label text-xs font-semibold text-white/50 mb-4">Risk Distribution</h3>
                                <div class="h-[260px] flex items-center justify-center">
                                    <canvas id="chart-risk-pie" width="260" height="260"></canvas>
                                </div>
                            </div>
                            <div class="glass-panel p-6">
                                <h3 class="chart-label text-xs font-semibold text-white/50 mb-4">Stock by Ingredient
                                </h3>
                                <div class="h-[260px] flex items-center justify-center">
                                    <canvas id="chart-stock-bar" width="400" height="260"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="glass-panel p-6">
                            <h3 class="chart-label text-xs font-semibold text-white/50 mb-4">Total Stock by Location
                            </h3>
                            <div class="h-[240px] flex items-center justify-center">
                                <canvas id="chart-locations-bar" width="500" height="240"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Reports panel (hidden by default) -->
                    <div id="reports-panel" class="hidden pb-16">
                        <div class="panel-header-row">
                            <h2 class="report-section-title">Reports</h2>
                            <div class="flex items-center gap-2">
                                <label for="reports-location-select"
                                    class="chart-label text-[10px] text-white/50">Location</label>
                                <select id="reports-location-select"
                                    class="input-clean px-4 py-2 rounded-xl text-sm min-w-[160px]">
                                    <option value="all">All locations</option>
                                    <option value="main">Main Kitchen</option>
                                    <option value="downtown">Downtown Branch</option>
                                    <option value="harbor">Harbor View</option>
                                </select>
                            </div>
                        </div>
                        <div class="space-y-5">
                            <div class="collapsible-section glass-panel rounded-2xl overflow-hidden">
                                <div class="collapsible-header px-6 py-4 border-b border-white/5" data-collapse-toggle>
                                    <h3
                                        class="chart-label text-xs font-semibold text-white/70 uppercase tracking-wider">
                                        Low Stock Report</h3>
                                    <svg class="collapse-icon w-5 h-5 text-white/50 shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                <div class="collapsible-body px-6 py-5" style="max-height: 420px;">
                                    <p class="chart-subtext text-[10px] text-white/40 mb-4">Items below par level by
                                        location.</p>
                                    <div class="overflow-x-auto">
                                        <table class="report-table" id="report-low-stock-table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Location</th>
                                                    <th class="num">Current</th>
                                                    <th class="num">Par</th>
                                                    <th>Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="report-low-stock">
                                                <tr>
                                                    <td>Heavy Cream</td>
                                                    <td>Main Kitchen</td>
                                                    <td class="num">3 L</td>
                                                    <td class="num">8 L</td>
                                                    <td class="status-critical">Critical</td>
                                                </tr>
                                                <tr>
                                                    <td>Cherry Tomatoes</td>
                                                    <td>Downtown Branch</td>
                                                    <td class="num">5 kg</td>
                                                    <td class="num">12 kg</td>
                                                    <td class="status-low">Low</td>
                                                </tr>
                                                <tr>
                                                    <td>Extra Virgin Olive Oil</td>
                                                    <td>Harbor View</td>
                                                    <td class="num">2 L</td>
                                                    <td class="num">5 L</td>
                                                    <td class="status-low">Low</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="collapsible-section glass-panel rounded-2xl overflow-hidden">
                                <div class="collapsible-header px-6 py-4 border-b border-white/5" data-collapse-toggle>
                                    <h3
                                        class="chart-label text-xs font-semibold text-white/70 uppercase tracking-wider">
                                        Usage Report</h3>
                                    <svg class="collapse-icon w-5 h-5 text-white/50 shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                <div class="collapsible-body px-6 py-5" style="max-height: 420px;">
                                    <p class="chart-subtext text-[10px] text-white/40 mb-4">Consumption vs AI-predicted
                                        usage.</p>
                                    <div class="overflow-x-auto">
                                        <table class="report-table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Location</th>
                                                    <th class="num">Used</th>
                                                    <th class="num">Predicted</th>
                                                    <th class="num">Variance</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Heavy Cream</td>
                                                    <td>Main Kitchen</td>
                                                    <td class="num">12 L</td>
                                                    <td class="num">10 L</td>
                                                    <td class="num status-low">+20%</td>
                                                </tr>
                                                <tr>
                                                    <td>Flour</td>
                                                    <td>Downtown Branch</td>
                                                    <td class="num">24 kg</td>
                                                    <td class="num">26 kg</td>
                                                    <td class="num status-ok">−8%</td>
                                                </tr>
                                                <tr>
                                                    <td>Butter</td>
                                                    <td>Harbor View</td>
                                                    <td class="num">8 kg</td>
                                                    <td class="num">8 kg</td>
                                                    <td class="num status-ok">0%</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            <div class="collapsible-section glass-panel rounded-2xl overflow-hidden">
                                <div class="collapsible-header px-6 py-4 border-b border-white/5" data-collapse-toggle>
                                    <h3
                                        class="chart-label text-xs font-semibold text-white/70 uppercase tracking-wider">
                                        Variance Report</h3>
                                    <svg class="collapse-icon w-5 h-5 text-white/50 shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                <div class="collapsible-body px-6 py-5" style="max-height: 420px;">
                                    <p class="chart-subtext text-[10px] text-white/40 mb-4">Actual vs expected stock
                                        levels (cycle count).</p>
                                    <div class="overflow-x-auto">
                                        <table class="report-table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Location</th>
                                                    <th class="num">Expected</th>
                                                    <th class="num">Actual</th>
                                                    <th class="num">Diff</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Chicken Breast</td>
                                                    <td>Main Kitchen</td>
                                                    <td class="num">40 kg</td>
                                                    <td class="num">38 kg</td>
                                                    <td class="num status-low">−2 kg</td>
                                                </tr>
                                                <tr>
                                                    <td>Mozzarella</td>
                                                    <td>Downtown Branch</td>
                                                    <td class="num">15 kg</td>
                                                    <td class="num">15 kg</td>
                                                    <td class="num status-ok">0</td>
                                                </tr>
                                                <tr>
                                                    <td>Basil</td>
                                                    <td>Harbor View</td>
                                                    <td class="num">2 kg</td>
                                                    <td class="num">1.5 kg</td>
                                                    <td class="num status-low">−0.5 kg</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Forecasts panel (hidden by default) -->
                    <div id="forecasts-panel" class="hidden pb-16">
                        <div class="panel-header-row">
                            <h2 class="forecast-section-title">Forecasts</h2>
                            <div class="flex items-center gap-2">
                                <label for="forecasts-location-select"
                                    class="chart-label text-[10px] text-white/50">Location</label>
                                <select id="forecasts-location-select"
                                    class="input-clean px-4 py-2 rounded-xl text-sm min-w-[160px]">
                                    <option value="all">All locations</option>
                                    <option value="main">Main Kitchen</option>
                                    <option value="downtown">Downtown Branch</option>
                                    <option value="harbor">Harbor View</option>
                                </select>
                            </div>
                        </div>
                        <div class="space-y-5">
                            <div class="collapsible-section glass-panel rounded-2xl overflow-hidden">
                                <div class="collapsible-header px-6 py-4 border-b border-white/5" data-collapse-toggle>
                                    <h3
                                        class="chart-label text-xs font-semibold text-white/70 uppercase tracking-wider">
                                        Demand Forecast</h3>
                                    <svg class="collapse-icon w-5 h-5 text-white/50 shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                <div class="collapsible-body px-6 py-5" style="max-height: 420px;">
                                    <p class="chart-subtext text-[10px] text-white/40 mb-4">AI-predicted demand for the
                                        next 7 days.</p>
                                    <div class="overflow-x-auto">
                                        <table class="report-table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Location</th>
                                                    <th>Day 1–3</th>
                                                    <th>Day 4–5</th>
                                                    <th>Day 6–7</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Heavy Cream</td>
                                                    <td>Main Kitchen</td>
                                                    <td>High</td>
                                                    <td>Med</td>
                                                    <td>Med</td>
                                                </tr>
                                                <tr>
                                                    <td>Flour</td>
                                                    <td>Downtown Branch</td>
                                                    <td>Med</td>
                                                    <td>High</td>
                                                    <td>High</td>
                                                </tr>
                                                <tr>
                                                    <td>Salmon</td>
                                                    <td>Harbor View</td>
                                                    <td>Low</td>
                                                    <td>Med</td>
                                                    <td>Med</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4">
                                        <div class="forecast-card"><span class="label block mb-0.5">Horizon</span><span
                                                class="value">7 days</span></div>
                                        <div class="forecast-card"><span class="label block mb-0.5">Updated</span><span
                                                class="value">Today</span></div>
                                        <div class="forecast-card"><span class="label block mb-0.5">Model</span><span
                                                class="value">SpellStock AI</span></div>
                                        <div class="forecast-card"><span
                                                class="label block mb-0.5">Confidence</span><span
                                                class="value">87%</span></div>
                                    </div>
                                </div>
                            </div>
                            <div class="collapsible-section glass-panel rounded-2xl overflow-hidden">
                                <div class="collapsible-header px-6 py-4 border-b border-white/5" data-collapse-toggle>
                                    <h3
                                        class="chart-label text-xs font-semibold text-white/70 uppercase tracking-wider">
                                        Stockout Risk</h3>
                                    <svg class="collapse-icon w-5 h-5 text-white/50 shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                <div class="collapsible-body px-6 py-5" style="max-height: 420px;">
                                    <p class="chart-subtext text-[10px] text-white/40 mb-4">Predicted risk of stockout
                                        by item and location.</p>
                                    <div class="overflow-x-auto">
                                        <table class="report-table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Location</th>
                                                    <th class="num">Risk %</th>
                                                    <th>Level</th>
                                                    <th>Suggested action</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr>
                                                    <td>Heavy Cream</td>
                                                    <td>Main Kitchen</td>
                                                    <td class="num">92</td>
                                                    <td class="status-critical">Critical</td>
                                                    <td class="text-white/60 text-xs">Reorder within 24h</td>
                                                </tr>
                                                <tr>
                                                    <td>Cherry Tomatoes</td>
                                                    <td>Downtown Branch</td>
                                                    <td class="num">68</td>
                                                    <td class="status-low">High</td>
                                                    <td class="text-white/60 text-xs">Schedule delivery</td>
                                                </tr>
                                                <tr>
                                                    <td>Butter</td>
                                                    <td>Harbor View</td>
                                                    <td class="num">22</td>
                                                    <td class="status-ok">Low</td>
                                                    <td class="text-white/60 text-xs">Monitor</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3 mt-4">
                                        <div class="forecast-card"><span class="label block mb-0.5">Critical
                                                items</span><span class="value status-critical">2</span></div>
                                        <div class="forecast-card"><span class="label block mb-0.5">High
                                                risk</span><span class="value status-low">4</span></div>
                                        <div class="forecast-card"><span class="label block mb-0.5">Horizon</span><span
                                                class="value">72 h</span></div>
                                        <div class="forecast-card"><span class="label block mb-0.5">Last run</span><span
                                                class="value">2h ago</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <script src="../static/backend/alerts.js"></script>

                    <!-- ═══ ALERTS PANEL ═══ -->
                    <div id="alerts-panel" class="hidden pb-16">
                        <!-- ═══ INITIAL STATE: Hero CTA ═══ -->
                        <div id="alerts-initial"
                            class="flex flex-col items-center justify-center min-h-[60vh] text-center space-y-8">
                            <div class="relative">
                                <div class="absolute inset-0 bg-indigo-500/10 blur-[80px] rounded-full -z-10"></div>
                                <div
                                    class="w-24 h-24 border-2 border-indigo-500/30 rounded-full flex items-center justify-center mb-6 mx-auto">
                                    <svg class="w-12 h-12 text-indigo-400" fill="none" stroke="currentColor"
                                        viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                                            d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                                    </svg>
                                </div>
                                <h2 class="page-title text-3xl font-bold text-white mb-3">AI Risk <span
                                        class="text-white/40">Scanner</span></h2>
                                <p class="text-sm text-white/30 max-w-md mx-auto leading-relaxed mb-8">Scan your live
                                    classifier predictions through the full pipeline — risk events, rule engine,
                                    eligibility, and Gemini-powered alert phrasing.</p>
                                <button id="btn-run-check" type="button"
                                    class="btn-primary inline-flex items-center gap-3 py-3 pl-3 pr-8 rounded-full text-base font-semibold mx-auto">
                                    <div id="check-icon"
                                        class="w-12 h-12 bg-white rounded-full flex items-center justify-center text-black">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                                d="M13 10V3L4 14h7v7l9-11h-7z" />
                                        </svg>
                                    </div>
                                    <span>Run Inventory Check</span>
                                </button>
                                <p id="alerts-scan-status"
                                    class="text-[10px] mono uppercase text-white/15 tracking-[0.2em] mt-6">Ready to scan
                                </p>
                            </div>
                        </div>
                        <style>
                            .mini-card {
                                background: rgba(255, 255, 255, 0.04);
                                border: 1px solid rgba(255, 255, 255, 0.08);
                                border-radius: 0.75rem;
                                padding: 0.35rem 0.4rem;
                                display: flex;
                                flex-direction: column;
                                align-items: center;
                                color: rgba(255, 255, 255, 0.6);
                            }

                            .mini-card b {
                                color: white;
                                font-size: 0.75rem;
                            }
                        </style>

                        <!-- ═══ RESULTS STATE (hidden until scan completes) ═══ -->
                        <!-- ═══ RESULTS STATE ═══ -->
                        <div id="alerts-results" class="hidden h-[calc(100vh-8rem)]">

                            <!-- Two-column fixed layout -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 h-full">

                                <!-- STOCKOUTS -->
                                <div class="flex flex-col h-full rounded-2xl border border-white/10 bg-white/5">
                                    <div class="p-4 border-b border-white/10">
                                        <h3 class="text-sm font-semibold text-indigo-300">Stockout Alerts</h3>

                                        <!-- Mini summary -->
                                        <div class="grid grid-cols-4 gap-2 mt-3 text-[10px]">
                                            <div class="mini-card"><span>Pred</span><b id="s-pred">-</b></div>
                                            <div class="mini-card"><span>Risk</span><b id="s-risk">-</b></div>
                                            <div class="mini-card"><span>Rules</span><b id="s-rules">-</b></div>
                                            <div class="mini-card"><span>Alerts</span><b id="s-alerts">-</b></div>
                                        </div>
                                    </div>

                                    <!-- Scrollable list -->
                                    <div id="alerts-stockout" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
                                </div>

                                <!-- WASTAGE -->
                                <div class="flex flex-col h-full rounded-2xl border border-white/10 bg-white/5">
                                    <div class="p-4 border-b border-white/10">
                                        <h3 class="text-sm font-semibold text-emerald-300">Wastage Alerts</h3>

                                        <!-- Mini summary -->
                                        <div class="grid grid-cols-4 gap-2 mt-3 text-[10px]">
                                            <div class="mini-card"><span>Pred</span><b id="w-pred">-</b></div>
                                            <div class="mini-card"><span>Risk</span><b id="w-risk">-</b></div>
                                            <div class="mini-card"><span>Rules</span><b id="w-rules">-</b></div>
                                            <div class="mini-card"><span>Alerts</span><b id="w-alerts">-</b></div>
                                        </div>
                                    </div>

                                    <!-- Scrollable list -->
                                    <div id="alerts-waste" class="flex-1 overflow-y-auto p-4 space-y-3"></div>
                                </div>

                            </div>
                        </div>



                        <!-- ═══ AGENT AUTOPILOT PANEL ═══ -->
                        <div id="agent-panel" class="hidden pb-16">
                            <div class="panel-header-row mb-6">
                                <div>
                                    <h2 class="section-title text-sm text-white/60">Agent Autopilot</h2>
                                    <p class="chart-subtext text-[10px] text-white/30 mt-1">Autonomous inventory
                                        operations
                                        — Sense → Plan → Execute</p>
                                </div>
                                <div class="flex items-center gap-3">
                                    <!-- Autopilot Toggle -->
                                    <div
                                        class="flex items-center gap-2 glass-panel px-4 py-2 rounded-full border-white/10">
                                        <span
                                            class="text-[9px] mono uppercase tracking-widest text-white/40">Autopilot</span>
                                        <div id="autopilot-toggle"
                                            class="flex rounded-full bg-white/5 border border-white/10 overflow-hidden">
                                            <button data-mode="off"
                                                class="autopilot-mode-btn active text-[9px] mono uppercase tracking-widest px-3 py-1.5 transition-all">Off</button>
                                            <button data-mode="guarded"
                                                class="autopilot-mode-btn text-[9px] mono uppercase tracking-widest px-3 py-1.5 transition-all">Guarded</button>
                                            <button data-mode="full"
                                                class="autopilot-mode-btn text-[9px] mono uppercase tracking-widest px-3 py-1.5 transition-all">Full</button>
                                        </div>
                                    </div>
                                    <button id="btn-agent-plan" type="button"
                                        class="btn-primary flex items-center gap-3 py-2 pl-2 pr-6 rounded-full text-sm font-semibold">
                                        <div
                                            class="w-10 h-10 bg-white rounded-full flex items-center justify-center text-black">
                                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                                    d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                            </svg>
                                        </div>
                                        <span>Generate Plan</span>
                                    </button>
                                </div>
                            </div>

                            

                            <!-- Command Input -->
                            <div class="glass-panel p-4 mb-6 flex items-center gap-3">
                                <div class="flex-1">
                                    <input id="agent-command-input" type="text"
                                        placeholder="Operator command... e.g. 'Fix top 3 stockout alerts' or 'Draft PO for chicken'"
                                        class="input-clean w-full px-4 py-3 rounded-xl text-sm" />
                                </div>
                                <button id="btn-agent-command" type="button"
                                    class="btn-primary w-10 h-10 rounded-full flex items-center justify-center shrink-0">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                            d="M14 5l7 7m0 0l-7 7m7-7H3" />
                                    </svg>
                                </button>
                            </div>

                            <!-- Action Queue Table -->
                            <div class="collapsible-section glass-panel rounded-2xl overflow-hidden mb-6">
                                <div class="collapsible-header px-6 py-4 border-b border-white/5" data-collapse-toggle>
                                    <h3
                                        class="chart-label text-xs font-semibold text-white/70 uppercase tracking-wider">
                                        Action Queue</h3>
                                    <div class="flex items-center gap-3">
                                        <select id="agent-filter-status"
                                            class="input-clean px-3 py-1.5 rounded-lg text-[10px] mono">
                                            <option value="">All Status</option>
                                            <option value="proposed">Proposed</option>
                                            <option value="approved">Approved</option>
                                            <option value="executed">Executed</option>
                                            <option value="rejected">Rejected</option>
                                            <option value="rolled_back">Rolled Back</option>
                                        </select>
                                        <select id="agent-filter-owner"
                                            class="input-clean px-3 py-1.5 rounded-lg text-[10px] mono">
                                            <option value="">All Owners</option>
                                            <option value="Purchasing">Purchasing</option>
                                            <option value="Kitchen">Kitchen</option>
                                            <option value="VendorOps">VendorOps</option>
                                        </select>
                                        <button id="btn-agent-auto" type="button"
                                            class="text-[9px] mono uppercase tracking-widest py-1.5 px-3 border border-emerald-500/30 text-emerald-400 rounded-full hover:bg-emerald-500/10 transition-all">Auto-Execute</button>
                                        <svg class="collapse-icon w-5 h-5 text-white/50 shrink-0" fill="none"
                                            stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                </div>
                                <div class="collapsible-body px-6 py-4" style="max-height: 600px; overflow-y: auto;">
                                    <div class="overflow-x-auto">
                                        <table class="report-table" id="agent-queue-table">
                                            <thead>
                                                <tr>
                                                    <th class="cursor-pointer hover:text-white/80"
                                                        data-sort="action_type">
                                                        Type ↕</th>
                                                    <th>Ingredient</th>
                                                    <th class="cursor-pointer hover:text-white/80"
                                                        data-sort="risk_level">
                                                        Risk ↕</th>
                                                    <th class="cursor-pointer hover:text-white/80"
                                                        data-sort="owner_role">
                                                        Owner ↕</th>
                                                    <th class="cursor-pointer hover:text-white/80" data-sort="status">
                                                        Status
                                                        ↕</th>
                                                    <th>Reason</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="agent-queue-body">
                                                <tr>
                                                    <td colspan="7" class="text-center text-white/20 py-8">No actions
                                                        yet.
                                                        Click "Generate Plan" to start.</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <!-- Diff View -->
                            <div id="agent-diff-view" class="hidden glass-panel rounded-2xl overflow-hidden mb-6">
                                <div class="px-6 py-4 border-b border-white/5 flex items-center justify-between">
                                    <h3
                                        class="chart-label text-xs font-semibold text-white/70 uppercase tracking-wider">
                                        Action Details — Diff View</h3>
                                    <button id="btn-close-diff"
                                        class="text-white/30 hover:text-white transition-colors">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                d="M6 18L18 6M6 6l12 12" />
                                        </svg>
                                    </button>
                                </div>
                                <div id="agent-diff-content" class="px-6 py-4 space-y-4"></div>
                            </div>

                            <!-- Audit Log -->
                            <div class="collapsible-section glass-panel rounded-2xl overflow-hidden">
                                <div class="collapsible-header px-6 py-4 border-b border-white/5" data-collapse-toggle>
                                    <h3
                                        class="chart-label text-xs font-semibold text-white/70 uppercase tracking-wider">
                                        Audit Log</h3>
                                    <svg class="collapse-icon w-5 h-5 text-white/50 shrink-0" fill="none"
                                        stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M19 9l-7 7-7-7" />
                                    </svg>
                                </div>
                                <div class="collapsible-body px-6 py-4" style="max-height: 400px; overflow-y: auto;">
                                    <div id="agent-audit-log" class="space-y-2">
                                        <p class="text-[10px] mono text-white/20 text-center py-4">No audit entries yet.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ═══ CHAT PANEL ═══ -->
                        <div id="chat-panel" class="hidden pb-16">
                            <div class="panel-header-row mb-6">
                                <div>
                                    <h2 class="section-title text-sm text-white/60">Manager Assistant</h2>
                                    <p class="chart-subtext text-[10px] text-white/30 mt-1">Ask questions about
                                        inventory,
                                        risks, and recommendations</p>
                                </div>
                            </div>
                            <div class="glass-panel flex flex-col"
                                style="height: calc(100vh - 220px); min-height: 400px;">
                                <!-- Chat messages -->
                                <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-4">
                                    <div class="flex items-start gap-3">
                                        <div
                                            class="w-8 h-8 rounded-full bg-indigo-500/20 border border-indigo-500/30 flex items-center justify-center shrink-0">
                                            <svg class="w-4 h-4 text-indigo-400" fill="none" stroke="currentColor"
                                                viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M9.75 3.104v5.714a2.25 2.25 0 01-.659 1.591L5 14.5M9.75 3.104c-.251.023-.501.05-.75.082m.75-.082a24.301 24.301 0 014.5 0m0 0v5.714c0 .597.237 1.17.659 1.591L19 14.5M14.25 3.104c.251.023.501.05.75.082M19 14.5l-1.405 2.81A2.25 2.25 0 0115.604 19H8.396a2.25 2.25 0 01-1.991-1.69L5 14.5m14 0H5" />
                                            </svg>
                                        </div>
                                        <div
                                            class="bg-white/5 border border-white/5 rounded-2xl rounded-tl-sm px-4 py-3 max-w-[80%]">
                                            <p class="text-sm text-white/80">Hi! I'm SpellStock AI. Ask me about
                                                inventory
                                                risks, recent trends, or what to prep for the weekend. I'll reference
                                                real
                                                data from your operations.</p>
                                        </div>
                                    </div>
                                </div>
                                <!-- Quick question chips -->
                                <div class="px-6 py-3 border-t border-white/5 flex flex-wrap gap-2"
                                    id="chat-quick-questions">
                                    <button
                                        class="chat-chip text-[9px] mono uppercase tracking-widest py-1.5 px-3 border border-white/10 rounded-full hover:bg-white hover:text-black transition-all"
                                        data-q="Why did I get this alert?">Why this alert?</button>
                                    <button
                                        class="chat-chip text-[9px] mono uppercase tracking-widest py-1.5 px-3 border border-white/10 rounded-full hover:bg-white hover:text-black transition-all"
                                        data-q="What items are riskiest this week?">Riskiest items</button>
                                    <button
                                        class="chat-chip text-[9px] mono uppercase tracking-widest py-1.5 px-3 border border-white/10 rounded-full hover:bg-white hover:text-black transition-all"
                                        data-q="What should I prep more for the weekend?">Weekend prep</button>
                                    <button
                                        class="chat-chip text-[9px] mono uppercase tracking-widest py-1.5 px-3 border border-white/10 rounded-full hover:bg-white hover:text-black transition-all"
                                        data-q="How can I reduce waste this week?">Reduce waste</button>
                                </div>
                                <!-- Chat input -->
                                <div class="p-4 border-t border-white/5 flex items-center gap-3">
                                    <input id="chat-input" type="text"
                                        placeholder="Ask about inventory, alerts, or recommendations..."
                                        class="input-clean flex-1 px-4 py-3 rounded-xl text-sm" />
                                    <button id="btn-chat-send" type="button"
                                        class="btn-primary w-10 h-10 rounded-full flex items-center justify-center shrink-0">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                                d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                </main>
            </div>

            <!-- Footer Global HUD -->
            <footer
                class="fixed bottom-0 left-64 right-0 bg-[#0a0a0c]/95 backdrop-blur-md border-t border-white/5 px-6 py-2 flex items-center justify-between z-50">
                <div class="flex items-center gap-2">
                    <span class="w-1.5 h-1.5 bg-emerald-400 rounded-full"></span>
                    <span class="chart-label text-[10px] text-white/40">Prediction Engine Live</span>
                </div>
                <div class="chart-subtext text-[10px] text-white/30 flex items-center gap-3">
                    <span id="footer-time"></span>
                    <span>SpellStock v2.5</span>
                </div>
            </footer>
        </div>
    </div>
    <script>
        (function () {
            var el = document.getElementById('footer-time');
            if (el) {
                function tick() { el.textContent = new Date().toLocaleTimeString(); }
                tick();
                setInterval(tick, 1000);
            }
        })();
    </script>
    <script src="{{ url_for('static', filename='backend/main.js') }}"></script>
</body>

</html>